<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Play Free Online Games - Gamely Hub | Instant Play, No Download</title>
    <meta name="title" content="Play Free Online Games - Gamely Hub | Instant Play, No Download">
    <meta name="description" content="Play the best free online games instantly at Gamely Hub! No downloads required. Enjoy action games, puzzle games, adventure games, and more. Play now in your browser!">
    <meta name="keywords" content="play games online, free online games, browser games, instant play games, no download games, HTML5 games, play games free, online gaming">
    <meta name="author" content="Gamely Hub">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="theme-color" content="#6366f1">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://gamelyhub.com/pages/game_detail_play.html">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://gamelyhub.com/pages/game_detail_play.html">
    <meta property="og:title" content="Play Free Online Games - Gamely Hub | Instant Play, No Download">
    <meta property="og:description" content="Play the best free online games instantly at Gamely Hub! No downloads required. Enjoy action games, puzzle games, adventure games, and more.">
    <meta property="og:image" content="https://gamelyhub.com/public/images/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Play Free Online Games - Gamely Hub">
    <meta property="og:site_name" content="Gamely Hub">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://gamelyhub.com/pages/game_detail_play.html">
    <meta name="twitter:title" content="Play Free Online Games - Gamely Hub | Instant Play, No Download">
    <meta name="twitter:description" content="Play the best free online games instantly at Gamely Hub! No downloads required. Enjoy action games, puzzle games, adventure games, and more.">
    <meta name="twitter:image" content="https://gamelyhub.com/public/images/og-image.jpg">
    <meta name="twitter:image:alt" content="Play Free Online Games - Gamely Hub">
    
    <!-- Additional SEO Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Gamely Hub">
    <meta name="application-name" content="Gamely Hub">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Favicon and Icons -->
    <link rel="icon" type="image/x-icon" href="../public/images/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/images/favicon-32x32.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="../public/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="../public/images/android-chrome-512x512.png">
    
    <!-- Structured Data (JSON-LD) - Will be dynamically updated by JavaScript -->
    <script type="application/ld+json" id="gameStructuredData">
    {
      "@context": "https://schema.org",
      "@type": "WebPage",
      "name": "Play Free Online Games",
      "description": "Play the best free online games instantly at Gamely Hub",
      "url": "https://gamelyhub.com/pages/game_detail_play.html"
    }
    </script>

    <!-- Cookie Consent CSS (loads before other styles) -->
    <link href="../css/cookie-consent.css" rel="stylesheet">
    
    <!-- Note: Google Analytics and AdSense are loaded conditionally after cookie consent -->

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <!-- Custom CSS -->
    <link href="../css/main.css" rel="stylesheet">
    <link href="../css/advertisements.css" rel="stylesheet">
    <style>
        /* Container larger width - consistent for header, main, and footer */
        .container-fluid {
            padding-left: 2rem;
            padding-right: 2rem;
        }

        @media (min-width: 1200px) {
            .container-fluid {
                padding-left: 3rem;
                padding-right: 3rem;
            }
        }

        /* Ensure navbar container matches footer container */
        .navbar .container-fluid {
            padding-left: 2rem;
            padding-right: 2rem;
        }

        @media (min-width: 1200px) {
            .navbar .container-fluid {
                padding-left: 3rem;
                padding-right: 3rem;
            }
        }

        /* Game header container */
        .game-header .container {
            max-width: 1320px;
            margin: 0 auto;
        }

        /* 5-column grid for large screens */
        @media (min-width: 992px) {
            .game-grid-5 > [class*="col-lg-3"] {
                flex: 0 0 20% !important;
                max-width: 20% !important;
            }
        }

        /* Enhanced Footer Styles - Light Theme */
        .footer {
            background: #F8FAFC;
            border-top: 1px solid rgba(148, 163, 184, 0.2);
            color: var(--text-primary);
            padding: 3rem 0 1.5rem;
            margin-top: 4rem;
        }

        .footer h5, .footer h6 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .footer-links-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .footer-links-list li {
            margin-bottom: 0.5rem;
        }

        .footer-link {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s ease, padding-left 0.3s ease;
            display: inline-block;
        }

        .footer-link:hover {
            color: var(--primary-color);
            padding-left: 5px;
        }

        .footer-social a {
            display: inline-block;
            width: 36px;
            height: 36px;
            line-height: 36px;
            text-align: center;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50%;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
            color: var(--primary-color);
        }

        .footer-social a:hover {
            background: var(--primary-color);
            color: #fff;
            transform: translateY(-2px);
        }

        .footer-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        @media (max-width: 768px) {
            .footer {
                padding: 2rem 0 1rem;
            }
        }

        /* Game Full Content Styling */
        .game-full-content {
            margin-bottom: 3rem;
        }

        .game-full-content .game-card {
            background: var(--card-bg, #ffffff);
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .game-full-content h2 {
            color: var(--primary-color, #6366f1);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            margin-top: 0;
        }

        .game-full-content h3 {
            color: var(--text-primary, #1e293b);
            font-size: 1.5rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
        }

        .game-full-content p {
            color: var(--text-secondary, #64748b);
            line-height: 1.8;
            margin-bottom: 1rem;
            font-size: 1rem;
        }

        .game-full-content p:last-child {
            margin-bottom: 0;
        }

        /* Sidebar game grids - Left and Right */
        .main-content-wrapper {
            display: flex;
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            padding: 0;
            gap: 2rem;
            position: relative;
            align-items: flex-start;
        }

        .sidebar-games {
            width: 280px;
            flex-shrink: 0;
            padding: 1rem;
            position: sticky;
            top: 100px;
            height: fit-content;
            max-height: calc(100vh - 120px);
            overflow-y: auto;
            background: transparent;
        }

        .sidebar-games::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-games::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar-games::-webkit-scrollbar-thumb {
            background: rgba(148, 163, 184, 0.3);
            border-radius: 3px;
        }

        .sidebar-games::-webkit-scrollbar-thumb:hover {
            background: rgba(148, 163, 184, 0.5);
        }

        .sidebar-games h3 {
            color: var(--text-primary, #1e293b);
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .sidebar-games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .sidebar-game-card {
            position: relative;
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            aspect-ratio: 16 / 9;
            background: var(--card-bg, #ffffff);
        }

        .sidebar-game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .sidebar-game-card a {
            display: block;
            width: 100%;
            height: 100%;
            text-decoration: none;
        }

        .sidebar-game-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .sidebar-games-loading {
            text-align: center;
            padding: 1rem;
            color: var(--text-secondary, #64748b);
            font-size: 0.875rem;
        }

        /* Hide sidebars on smaller screens */
        @media (max-width: 1400px) {
            .sidebar-games {
                display: none;
            }
            
            .main-content-wrapper {
                justify-content: center;
            }
        }

        @media (min-width: 1401px) {
            .main-content-wrapper {
                justify-content: center;
                padding: 0 1rem;
            }
        }

        /* Game Title - Medium Size */
        #gameTitle {
            font-size: 2.5rem;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 1.5rem;
        }

        @media (max-width: 768px) {
            #gameTitle {
                font-size: 2rem;
            }
        }

        /* Category Tags - Chip Style */
        #gameCategories {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: center;
            align-items: center;
        }

        .category-tag {
            display: inline-block;
            padding: 0.5rem 1.25rem;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50px;
            color: white;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .category-tag:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>

<body class="bg-background text-text-primary">
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light fixed-top" style="z-index: 100;">
        <div class="container-fluid" style="max-width: 1320px; margin: 0 auto;">
            <a class="navbar-brand" href="../">
                <img src="../public/images/logo.png" alt="Gamely Hub" style="height: 58px;">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                title="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../">
                            Games
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="about.html">
                            About
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="contact.html">
                            Contact
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="search_discovery.html">
                            <i class="fas fa-search me-1"></i>Search
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Game Header -->
    <header class="game-header">
        <!-- Mobile Advertisement Banner (only visible on small screens) -->
        <!-- <div class="advertisement-banner mb-4 d-block d-md-none">
            <div class="ad-placeholder bg-light p-3 text-center rounded">
                <p class="mb-0">Advertisement Space</p>
                <small>Mobile Exclusive Ad</small>
            </div>
        </div> -->
        <div class="container-fluid" style="max-width: 1320px; margin: 0 auto;">
            <div class="row align-items-center">
                <div class="col-12 text-center">
                    <h1 id="gameTitle" class="text-white mb-3">Loading...</h1>
                    <img id="gameLogo" src="" alt="Game Logo" class="game-logo mb-3 mx-auto d-block">
                    <a href="#" id="playButtonTop" class="btn btn-light btn-lg w-75 d-block mx-auto mb-4 text-dark">
                        <i class="fas fa-play me-2"></i>Play Now
                    </a>
                    <div id="gameCategories" class="mb-4">
                        <!-- Categories will be added dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content Wrapper with Sidebars -->
    <div class="main-content-wrapper mt-5" style="position: relative; z-index: 10;">
        <!-- Left Sidebar Games -->
        <!-- <aside class="sidebar-games" id="leftSidebarGames">
            <h3>More Games</h3>
            <div class="sidebar-games-grid" id="leftSidebarGamesContainer">
                
            </div>
            <div class="sidebar-games-loading" id="leftSidebarGamesLoading" style="display: none;">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </aside> -->

        <!-- Main Content -->
        <main class="container-fluid" style="position: relative; z-index: 10; max-width: 1320px; margin: 0 auto; flex: 1;">
            <div class="row">
                <div class="col-12">
                <!-- Game Stats -->
                <section class="game-stats mb-5">
                    <div class="row g-4">
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <i class="fas fa-users"></i>
                                <h3 id="playerCount">-</h3>
                                <p>Players</p>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <i class="fas fa-star"></i>
                                <h3 id="gameRating">-</h3>
                                <p>Rating</p>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <i class="fas fa-chart-line"></i>
                                <h3 id="gameDifficulty">-</h3>
                                <p>Difficulty</p>
                            </div>
                        </div>
                        <div class="col-6 col-md-3">
                            <div class="stat-card">
                                <i class="fas fa-user-shield"></i>
                                <h3 id="ageRating">-</h3>
                                <p>Age Rating</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Top Advertisement Banner -->
                <!-- <div class="advertisement-banner mb-4">
                    <div class="ad-placeholder bg-light p-3 text-center rounded">
                        <p class="mb-0">Advertisement Space</p>
                        <small>Premium gaming deals and offers</small>
                    </div>
                </div> -->

                <!-- Game Full Content -->
                <section class="game-full-content mb-5" id="gameFullContentSection" style="display: none;">
                    <div class="game-card p-4">
                        <div id="gameFullContent">
                            <!-- Full content will be added dynamically -->
                        </div>
                    </div>
                </section>

                <!-- Game Screenshots -->
                <!-- Temporarily commented out
                <section class="game-screenshots mb-5">
                    <h2 class="text-gradient text-center mb-4">Screenshots</h2>
                    <div class="row g-4" id="screenshotsContainer">
                        Screenshots will be added dynamically
                    </div>
                </section>
                -->

                <!-- Top Advertisement Banner -->
                <!-- <div class="advertisement-banner mb-4">
                    <div class="ad-placeholder bg-light p-3 text-center rounded">
                        <p class="mb-0">Advertisement Space</p>
                        <small>Premium gaming deals and offers</small>
                    </div>
                </div> -->

                <!-- Related Games -->
                <section class="related-games">
                    <h2 class="text-gradient text-center mb-4">More Games to Play</h2>
                    <div class="row g-4 game-grid-5" id="relatedGamesContainer">
                        <!-- Related games will be added dynamically by JavaScript -->
                    </div>
                    <!-- Loading indicator for infinite scroll -->
                    <div class="text-center mt-4" id="relatedGamesLoadingIndicator" style="display: none;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2 text-muted">Loading more games...</p>
                    </div>
                </section>
                </div>
            </div>

            <!-- Bottom Advertisement Banner -->
            <!-- <div class="advertisement-banner mt-4">
                <div class="ad-placeholder bg-light p-3 text-center rounded">
                    <p class="mb-0">Advertisement Space</p>
                    <small>Special gaming offers and promotions</small>
                </div>
            </div> -->
        </main>

        <!-- Right Sidebar Games -->
        <!-- <aside class="sidebar-games" id="rightSidebarGames">
            <h3>Explore Games</h3>
            <div class="sidebar-games-grid" id="rightSidebarGamesContainer">
                
            </div>
            <div class="sidebar-games-loading" id="rightSidebarGamesLoading" style="display: none;">
                <div class="spinner-border spinner-border-sm text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>
        </aside> -->
    </div>

    <!-- Sticky Play Button -->
    <div class="sticky-play-button d-none">
        <a href="#" id="playButton" class="btn btn-primary btn-lg" target="_blank">
            <i class="fas fa-play me-2"></i>Play Now
        </a>
    </div>

    <!-- Footer -->
    <footer class="footer" style="position: relative; z-index: 10;">
        <div class="container-fluid" style="max-width: 1320px; margin: 0 auto;">
            <div class="row py-5">
                <!-- Brand Column -->
                <div class="col-12 col-md-6 col-lg-3 mb-4 mb-lg-0">
                    <h5 class="mb-3">
                        <img src="../public/images/logo.png" alt="Gamely Hub" style="height: 90px;">
                    </h5>
                    <p class="footer-text mb-3">
                        Your ultimate gaming destination. Play the best free online games anytime, anywhere.
                    </p>
                    <div class="footer-social mb-3">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>

                <!-- Pages Links Column -->
                <div class="col-6 col-md-3 col-lg-2 mb-4 mb-lg-0">
                    <h6 class="mb-3">Pages</h6>
                    <ul class="list-unstyled footer-links-list">
                        <li><a href="../" class="footer-link">Home</a></li>
                        <li><a href="game_categories.html" class="footer-link">Categories</a></li>
                        <li><a href="search_discovery.html" class="footer-link">Search & Discovery</a></li>
                        <li><a href="about.html" class="footer-link">About Us</a></li>
                        <li><a href="contact.html" class="footer-link">Contact</a></li>
                    </ul>
                </div>

                <!-- Recent Games Column -->
                <div class="col-6 col-md-3 col-lg-2 mb-4 mb-lg-0">
                    <h6 class="mb-3">Recent Games</h6>
                    <ul class="list-unstyled footer-links-list">
                        <li><a href="game_detail_play.html?game=subwaysurferssingapore" class="footer-link">Subway Surfers</a></li>
                        <li><a href="game_detail_play.html?game=cookieclicker" class="footer-link">Cookie Clicker</a></li>
                        <li><a href="game_detail_play.html?game=2048" class="footer-link">2048</a></li>
                        <li><a href="game_detail_play.html?game=pacman" class="footer-link">Pacman</a></li>
                        <li><a href="game_detail_play.html?game=hextris" class="footer-link">Hextris</a></li>
                        <li><a href="game_detail_play.html?game=repuls" class="footer-link">Repuls</a></li>
                    </ul>
                </div>

                <!-- Popular Games Column -->
                <div class="col-6 col-md-3 col-lg-2 mb-4 mb-lg-0">
                    <h6 class="mb-3">Popular Games</h6>
                    <ul class="list-unstyled footer-links-list">
                        <li><a href="game_detail_play.html?game=subwaysurferssingapore" class="footer-link">Subway Surfers</a></li>
                        <li><a href="game_detail_play.html?game=cookieclicker" class="footer-link">Cookie Clicker</a></li>
                        <li><a href="game_detail_play.html?game=2048" class="footer-link">2048</a></li>
                        <li><a href="game_detail_play.html?game=pacman" class="footer-link">Pacman</a></li>
                        <li><a href="game_detail_play.html?game=hextris" class="footer-link">Hextris</a></li>
                        <li><a href="game_detail_play.html?game=repuls" class="footer-link">Repuls</a></li>
                    </ul>
                </div>

                <!-- Legal & Support Column -->
                <div class="col-6 col-md-3 col-lg-3 mb-4 mb-lg-0">
                    <h6 class="mb-3">Legal & Support</h6>
                    <ul class="list-unstyled footer-links-list">
                        <li><a href="privacy.html" class="footer-link">Privacy Policy</a></li>
                        <li><a href="terms.html" class="footer-link">Terms of Service</a></li>
                        <li><a href="cookie-policy.html" class="footer-link">Cookie Policy</a></li>
                        <li><a href="cookie-preferences.html" class="footer-link">Cookie Settings</a></li>
                        <li><a href="data-rights-request.html" class="footer-link">Data Rights</a></li>
                        <li><a href="contact.html" class="footer-link">Support</a></li>
                    </ul>
                </div>
            </div>

            <!-- Footer Bottom -->
            <div class="row border-top pt-4 mt-4" style="border-color: rgba(148, 163, 184, 0.2) !important;">
                <div class="col-12 text-center">
                    <p class="footer-text mb-0">
                        &copy; 2025 Gamely Hub. All rights reserved.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Games Data -->
    <script src="../public/games-data.js?v=3"></script>
    
    <!-- Game Loader Script -->
    <script src="../public/game-loader.js"></script>

    <!-- Game Detail Script -->
    <script>
        // Wait for both DOM and gamesData to be ready
        function waitForGamesData(callback) {
            let retryCount = 0;
            const maxRetries = 50; // Increased retries
            const retryDelay = 100;

            function check() {
                // Check if gamesData is defined and has content
                if (typeof gamesData !== 'undefined') {
                    const keys = Object.keys(gamesData);
                    // Make sure we have a reasonable number of games loaded (at least 20)
                    if (keys.length >= 20) {
                        callback();
                        return;
                    } else if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(check, retryDelay);
                        return;
                    }
                } else if (retryCount < maxRetries) {
                    retryCount++;
                    setTimeout(check, retryDelay);
                    return;
                }
                
                // Failed to load
                console.error('✗ gamesData failed to load after multiple retries');
                if (typeof gamesData !== 'undefined') {
                    console.error(`gamesData exists but only has ${Object.keys(gamesData).length} keys`);
                }
                window.location.href = '../index.html';
            }

            // Start checking after a small delay
            setTimeout(check, 50);
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Get game ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const gameId = urlParams.get('game');

            if (!gameId) {
                console.error('✗ No game ID provided in URL');
                window.location.href = '../index.html';
                return;
            }

            // Wait for gamesData to be fully loaded
            waitForGamesData(function() {
                // Get game data
                const game = gamesData[gameId];
                if (!game) {
                    const availableGames = Object.keys(gamesData).slice(0, 20);
                    console.error(`✗ Game "${gameId}" not found in gamesData.`);
                    console.error(`Available games (first 20):`, availableGames);
                    console.error(`Total games in gamesData: ${Object.keys(gamesData).length}`);
                    // Check if it's a case sensitivity issue
                    const lowerGameId = gameId.toLowerCase();
                    const foundGame = Object.keys(gamesData).find(key => key.toLowerCase() === lowerGameId);
                    window.location.href = '../index.html';
                    return;
                }

                // Game found, proceed with loading
                loadGameDetails(game);
            });
        });

        function loadGameDetails(game) {
            // Update page title
            document.title = `${game.title} - Gamely Hub`;

            // Update game header
            document.getElementById('gameTitle').textContent = game.title;
            document.getElementById('gameLogo').src = game.logo;
            document.getElementById('gameLogo').alt = `${game.title} Logo`;

            // Update categories
            const categoriesContainer = document.getElementById('gameCategories');
            categoriesContainer.innerHTML = ''; // Clear existing categories
            if (game.categories && Array.isArray(game.categories)) {
                game.categories.forEach(category => {
                    const categoryTag = document.createElement('span');
                    categoryTag.className = 'category-tag';
                    categoryTag.textContent = category;
                    categoriesContainer.appendChild(categoryTag);
                });
            }

            // Update stats
            if (game.stats) {
                document.getElementById('playerCount').textContent = game.stats.players || 'N/A';
                document.getElementById('gameRating').textContent = game.stats.rating || 'N/A';
                document.getElementById('gameDifficulty').textContent = game.stats.difficulty || 'N/A';
                document.getElementById('ageRating').textContent = game.stats.ageRating || 'N/A';
            }

            // Update full content
            const fullContentSection = document.getElementById('gameFullContentSection');
            const fullContentDiv = document.getElementById('gameFullContent');
            if (game.fullContent) {
                fullContentDiv.innerHTML = game.fullContent;
                fullContentSection.style.display = 'block';
            } else {
                fullContentSection.style.display = 'none';
            }

            // Update screenshots
            // const screenshotsContainer = document.getElementById('screenshotsContainer');
            // screenshotsContainer.innerHTML = ''; // Clear existing screenshots
            // if (game.screenshots && Array.isArray(game.screenshots)) {
            //     game.screenshots.forEach(screenshot => {
            //         const col = document.createElement('div');
            //         col.className = 'col-12 col-md-6';
            //         col.innerHTML = `
            //             <div class="screenshot-card">
            //                 <img src="${screenshot}" alt="${game.title} Screenshot" class="img-fluid rounded">
            //             </div>
            //         `;
            //         screenshotsContainer.appendChild(col);
            //     });
            // }

            // Related games will be loaded dynamically using GameLoader

            // Update play button
            const playButton = document.getElementById('playButtonTop');
            playButton.href = `../games/${game.id}/index.html`;
        }
    </script>

    <script>
        // Load more games dynamically using GameLoader
        function loadMoreGames() {
            // Wait for both gamesData and GameLoader to be ready
            function waitForDependencies(callback) {
                let retryCount = 0;
                const maxRetries = 50;
                const retryDelay = 100;

                function check() {
                    if (typeof gamesData !== 'undefined' && typeof GameLoader !== 'undefined') {
                        const keys = Object.keys(gamesData);
                        if (keys.length >= 20 && GameLoader.loadGames) {
                            callback();
                            return;
                        }
                    }
                    
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(check, retryDelay);
                    } else {
                        console.error('✗ Failed to load dependencies');
                    }
                }
                
                setTimeout(check, 50);
            }

            waitForDependencies(function() {
                const urlParams = new URLSearchParams(window.location.search);
                const currentGameId = urlParams.get('game');
                const relatedGamesContainer = document.getElementById('relatedGamesContainer');
                
                if (!relatedGamesContainer) {
                    console.error('relatedGamesContainer not found');
                    return;
                }

                // Get all games and filter out current game
                const allGames = GameLoader.getAllGames();
                const filteredGames = allGames.filter(game => game.id !== currentGameId);
                
                // Shuffle the filtered games
                const shuffledGames = filteredGames.sort(() => 0.5 - Math.random());
                
                // Create a custom loadGames function that uses filtered games
                function loadFilteredGames(startIndex = 0, count = 20) {
                    const gamesToLoad = shuffledGames.slice(startIndex, startIndex + count);
                    
                    gamesToLoad.forEach(game => {
                        if (game && game.id) {
                            const cardHTML = GameLoader.generateGameCard(game, false);
                            if (cardHTML) {
                                relatedGamesContainer.insertAdjacentHTML('beforeend', cardHTML);
                            }
                        }
                    });
                    
                    // Initialize lazy loading for new images
                    setTimeout(() => {
                        GameLoader.initLazyLoading();
                    }, 100);
                    
                    const newIndex = startIndex + gamesToLoad.length;
                    return {
                        loaded: newIndex,
                        total: shuffledGames.length,
                        hasMore: newIndex < shuffledGames.length
                    };
                }
                
                // Load initial games
                const result = loadFilteredGames(0, 20);
                
                // Setup infinite scroll if there are more games
                if (result.hasMore) {
                    let currentIndex = 20;
                    let isLoading = false;
                    let hasMore = true;
                    const loadingIndicator = document.getElementById('relatedGamesLoadingIndicator');
                    
                    const observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting && hasMore && !isLoading) {
                                isLoading = true;
                                if (loadingIndicator) {
                                    loadingIndicator.style.display = 'block';
                                }
                                
                                observer.unobserve(entry.target);
                                
                                setTimeout(() => {
                                    const loadResult = loadFilteredGames(currentIndex, 20);
                                    currentIndex = loadResult.loaded;
                                    hasMore = loadResult.hasMore;
                                    isLoading = false;
                                    
                                    if (loadingIndicator) {
                                        loadingIndicator.style.display = 'none';
                                    }
                                    
                                    // Re-observe the new last element
                                    if (hasMore) {
                                        const lastCard = relatedGamesContainer.lastElementChild;
                                        if (lastCard) {
                                            setTimeout(() => observer.observe(lastCard), 100);
                                        }
                                    }
                                }, 300);
                            }
                        });
                    }, {
                        rootMargin: '200px'
                    });
                    
                    // Start observing the last card
                    setTimeout(() => {
                        const lastCard = relatedGamesContainer.lastElementChild;
                        if (lastCard) {
                            observer.observe(lastCard);
                        }
                    }, 500);
                }
            });
        }

        // Load games when page is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Wait a bit for gamesData to load
            setTimeout(loadMoreGames, 200);
        });
    </script>

    <script>
        // Function to generate image-only game card for sidebar
        function generateSidebarGameCard(game) {
            if (!game || !game.id) {
                return '';
            }

            // Get thumbnail using GameLoader's helper
            let thumbnail = '';
            if (typeof GameLoader !== 'undefined' && GameLoader.getGameThumbnail) {
                thumbnail = GameLoader.getGameThumbnail(game);
            } else {
                // Fallback thumbnail logic
                if (!game.thumbnail || game.thumbnail.trim() === "") {
                    const isInPages = window.location.pathname.includes('/pages/');
                    thumbnail = isInPages ? '../public/images/gam-thumb.png' : 'public/images/gam-thumb.png';
                } else {
                    const isInPages = window.location.pathname.includes('/pages/');
                    let path = game.thumbnail;
                    if (path.startsWith('../public/')) {
                        thumbnail = isInPages ? path : path.replace('../public/', 'public/');
                    } else if (path.startsWith('public/')) {
                        thumbnail = isInPages ? '../' + path : path;
                    } else {
                        if (!path.includes('public/')) {
                            path = (isInPages ? '../' : '') + 'public/' + path;
                        } else if (isInPages && !path.startsWith('../')) {
                            path = '../' + path;
                        }
                        thumbnail = path;
                    }
                }
            }

            // Generate game URL
            const isInPages = window.location.pathname.includes('/pages/');
            const gameUrl = isInPages ? `game_detail_play.html?game=${encodeURIComponent(game.id)}` : `pages/game_detail_play.html?game=${encodeURIComponent(game.id)}`;

            return `
                <div class="sidebar-game-card">
                    <a href="${gameUrl}" aria-label="Play ${game.title}">
                        <img data-src="${thumbnail}" alt="${game.title}" 
                            class="lazy-load" 
                            loading="lazy"
                            onerror="this.src='${isInPages ? '../public/images/gam-thumb.png' : 'public/images/gam-thumb.png'}'; this.onerror=null;" />
                    </a>
                </div>
            `;
        }

        // Load sidebar games dynamically
        function loadSidebarGames() {
            function waitForDependencies(callback) {
                let retryCount = 0;
                const maxRetries = 50;
                const retryDelay = 100;

                function check() {
                    if (typeof gamesData !== 'undefined' && typeof GameLoader !== 'undefined') {
                        const keys = Object.keys(gamesData);
                        if (keys.length >= 20 && GameLoader.getAllGames) {
                            callback();
                            return;
                        }
                    }
                    
                    if (retryCount < maxRetries) {
                        retryCount++;
                        setTimeout(check, retryDelay);
                    } else {
                        console.error('✗ Failed to load dependencies for sidebar games');
                    }
                }
                
                setTimeout(check, 50);
            }

            waitForDependencies(function() {
                const urlParams = new URLSearchParams(window.location.search);
                const currentGameId = urlParams.get('game');
                const leftContainer = document.getElementById('leftSidebarGamesContainer');
                const rightContainer = document.getElementById('rightSidebarGamesContainer');
                const leftLoading = document.getElementById('leftSidebarGamesLoading');
                const rightLoading = document.getElementById('rightSidebarGamesLoading');
                
                if (!leftContainer || !rightContainer) {
                    console.error('Sidebar containers not found');
                    return;
                }

                // Get all games and filter out current game
                const allGames = GameLoader.getAllGames();
                const filteredGames = allGames.filter(game => game.id !== currentGameId);
                
                // Shuffle the filtered games
                const shuffledGames = filteredGames.sort(() => 0.5 - Math.random());
                
                // Split games for left and right sidebars
                const midPoint = Math.ceil(shuffledGames.length / 2);
                const leftGames = shuffledGames.slice(0, midPoint);
                const rightGames = shuffledGames.slice(midPoint);
                
                // Load games into left sidebar
                function loadSidebar(container, games, loadingIndicator) {
                    const gamesPerLoad = 20;
                    let currentIndex = 0;
                    
                    function loadGames(startIndex, count) {
                        const gamesToLoad = games.slice(startIndex, startIndex + count);
                        
                        gamesToLoad.forEach(game => {
                            if (game && game.id) {
                                const cardHTML = generateSidebarGameCard(game);
                                if (cardHTML) {
                                    container.insertAdjacentHTML('beforeend', cardHTML);
                                }
                            }
                        });
                        
                        // Initialize lazy loading for new images
                        setTimeout(() => {
                            if (typeof GameLoader !== 'undefined' && GameLoader.initLazyLoading) {
                                GameLoader.initLazyLoading();
                            } else {
                                // Fallback lazy loading
                                const images = container.querySelectorAll('img.lazy-load');
                                images.forEach(img => {
                                    if (img.dataset.src) {
                                        img.src = img.dataset.src;
                                        img.removeAttribute('data-src');
                                        img.classList.remove('lazy-load');
                                    }
                                });
                            }
                        }, 100);
                        
                        return {
                            loaded: startIndex + gamesToLoad.length,
                            total: games.length,
                            hasMore: startIndex + gamesToLoad.length < games.length
                        };
                    }
                    
                    // Load initial games
                    const result = loadGames(0, gamesPerLoad);
                    currentIndex = result.loaded;
                    
                    // Setup infinite scroll if there are more games
                    if (result.hasMore) {
                        let isLoading = false;
                        let hasMore = true;
                        
                        const observer = new IntersectionObserver((entries) => {
                            entries.forEach(entry => {
                                if (entry.isIntersecting && hasMore && !isLoading) {
                                    isLoading = true;
                                    if (loadingIndicator) {
                                        loadingIndicator.style.display = 'block';
                                    }
                                    
                                    observer.unobserve(entry.target);
                                    
                                    setTimeout(() => {
                                        const loadResult = loadGames(currentIndex, gamesPerLoad);
                                        currentIndex = loadResult.loaded;
                                        hasMore = loadResult.hasMore;
                                        isLoading = false;
                                        
                                        if (loadingIndicator) {
                                            loadingIndicator.style.display = 'none';
                                        }
                                        
                                        // Re-observe the new last element
                                        if (hasMore) {
                                            const lastCard = container.lastElementChild;
                                            if (lastCard) {
                                                setTimeout(() => observer.observe(lastCard), 100);
                                            }
                                        }
                                    }, 300);
                                }
                            });
                        }, {
                            rootMargin: '200px'
                        });
                        
                        // Start observing the last card
                        setTimeout(() => {
                            const lastCard = container.lastElementChild;
                            if (lastCard) {
                                observer.observe(lastCard);
                            }
                        }, 500);
                    }
                }
                
                // Load games into both sidebars
                loadSidebar(leftContainer, leftGames, leftLoading);
                loadSidebar(rightContainer, rightGames, rightLoading);
            });
        }

        // Load sidebar games when page is ready
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(loadSidebarGames, 300);
        });
    </script>
    <!-- Cookie Consent Banner - Must be loaded last -->
    <!-- Navigation Highlight Script -->
    <script src="../public/nav-highlight.js"></script>
    <script src="../public/cookie-consent.js"></script>
</body>

</html>